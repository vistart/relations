# 核心概念

## 概述

Relations 包提供了一种类型安全的方式来定义和管理 Python 模型之间的关系。它围绕以下几个关键概念构建：

## 关系类型

支持三种主要的关系类型：

- **BelongsTo**: 表示多对一或一对一关系，实例属于单个关联实例
- **HasOne**: 表示一对一关系，实例有且仅有一个关联实例
- **HasMany**: 表示一对多关系，实例有多个关联实例

## 继承支持

该包支持关系继承和覆盖：

- 每个类维护自己的关系配置
- 子类可以覆盖父类关系
- 父类关系不受子类覆盖影响
- 关系覆盖可以修改关系定义的任何方面

## 关系描述符

RelationDescriptor 是管理关系的核心类。它：

- 处理相关数据的延迟加载
- 管理关系缓存
- 验证关系配置
- 支持循环依赖的前向引用
- 管理继承和覆盖

## 关系管理

RelationManagementMixin 提供：

- 关系注册
- 继承处理
- 缓存管理
- 关系查询能力
- 关系元数据访问

## 数据加载与查询

数据访问通过两种主要机制处理：

### RelationLoader
- 用于加载关联实例的接口
- 处理直接的关系访问
- 支持已加载数据的自动缓存
- 用于通过关系方法访问关联记录

### QuerySet
- 为关联数据提供灵活的查询接口
- 支持过滤和自定义查询方法
- 通过关系的 `_query` 属性访问
- 允许实时查询而不使用缓存
- 可以扩展自定义查询操作

## 缓存

缓存系统提供：

- 可配置的 TTL（生存时间）
- 防止内存问题的大小限制
- 线程安全操作
- 全局和每个关系的配置
- 已加载关系的自动缓存
- 缓存清理功能

## 类型安全

通过以下方式强制类型安全：

- 泛型类型参数
- 运行时类型检查
- 关系验证
- 前向引用解析

实现细节请参见[高级用法](advanced-usage.md)。